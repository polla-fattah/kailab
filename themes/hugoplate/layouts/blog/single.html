{{ define "main" }}
  {{ partial "page-header" . }}

  <section class="section">
    <div class="container">
      <div class="row">
        <div class="col-12 lg:col-8">
          <article class="mb-8">
            <!-- Blog Header -->
            <header class="mb-6">
              <h1 class="h2 mb-4">{{ .Title }}</h1>
              
              <!-- Meta Information -->
              <div class="flex flex-wrap items-center gap-4 text-sm text-text-light dark:text-darkmode-text-light mb-4">
                <span>
                  <i class="fa-regular fa-calendar mr-2"></i>
                  {{ .PublishDate.Format "January 2, 2006" }}
                </span>
                {{ with .Params.contributors }}
                  <span>
                    <i class="fa-regular fa-user mr-2"></i>
                    {{ $contributorId := . }}
                    {{ $authorFound := false }}
                    {{ $displayName := $contributorId }}
                    
                    <!-- Check if contributor exists in authors content files -->
                    {{ $authors := where site.RegularPages "Type" "authors" }}
                    {{ $author := where $authors "File.BaseFileName" $contributorId }}
                    {{ if $author }}
                      {{ $author = index $author 0 }}
                      {{ $lang := site.Language.Lang }}
                      {{ $name := $author.Params.name_en }}
                      {{ $title := $author.Params.title_en }}
                      {{ if eq $lang "ku" }}
                        {{ $name = $author.Params.name_ku }}
                        {{ $title = $author.Params.title_ku }}
                      {{ end }}
                      {{ $displayName = printf "%s %s" $title $name }}
                      {{ $authorFound = true }}
                    {{ end }}
                    
                    {{ if $authorFound }}
                      <a href="{{ `authors/` | relLangURL }}{{ $contributorId }}" class="hover:text-primary dark:hover:text-primary">
                        {{ $displayName }}
                      </a>
                    {{ else }}
                      {{ $contributorId }}
                    {{ end }}
                  </span>
                {{ end }}
              </div>
            </header>

            <!-- Blog Content -->
            <div class="content">
              {{ .Content }}
            </div>
          </article>
        </div>

        <!-- Sidebar -->
        <div class="col-12 lg:col-4">
          <div class="bg-light dark:bg-darkmode-light rounded-lg p-6 sticky top-4">
            <!-- Related Posts -->
            {{ $relatedPosts := where site.RegularPages "Section" "blog" }}
            {{ $relatedPosts = where $relatedPosts "File.BaseFileName" "!=" .File.BaseFileName }}
            {{ $relatedPosts = first 3 $relatedPosts }}
            
            {{ if $relatedPosts }}
              <h3 class="h5 mb-4">
                {{ if eq site.Language.Lang "ku" }}
                  نووسراوە پەیوەندیدارەکان
                {{ else }}
                  Related Posts
                {{ end }}
              </h3>
              <div class="space-y-4">
                {{ range $relatedPosts }}
                  <div class="border-b border-border dark:border-darkmode-border pb-4 last:border-b-0">
                    <h4 class="h6 mb-2">
                      <a href="{{ .RelPermalink }}" class="text-primary dark:text-darkmode-primary hover:underline">
                        {{ .Title }}
                      </a>
                    </h4>
                    <p class="text-sm text-text-light dark:text-darkmode-text-light">
                      {{ .PublishDate.Format "Jan 2, 2006" }}
                    </p>
                  </div>
                {{ end }}
              </div>
            {{ end }}
          </div>
        </div>
      </div>
    </div>
  </section>
{{ end }}
