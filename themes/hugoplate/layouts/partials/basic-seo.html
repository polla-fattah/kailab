{{ $lang_specific_metadata := index site.Params (site.Language.Lang) }}
{{ $metadata := site.Params.metadata }}
{{ if and $lang_specific_metadata $lang_specific_metadata.metadata }}
  {{ $metadata = $lang_specific_metadata.metadata }}
{{ end }}

{{ $description := .Description | default .Summary | default $metadata.description | default site.Params.metadata.description }}
{{ $title := .Title | default site.Title }}
{{ $image := .Params.image | default $metadata.image | default site.Params.metadata.image }}
{{ $author := .Params.author | default $metadata.author | default site.Params.metadata.author }}
{{ $keywords := .Params.keywords | default $metadata.keywords | default site.Params.metadata.keywords }}
{{ $site_name := $metadata.site_name | default site.Params.metadata.site_name | default site.Title }}

<!-- SEO Meta Tags -->
<meta name="description" content="{{ $description }}" />
<meta name="keywords" content="{{ if reflect.IsSlice $keywords }}{{ delimit $keywords ", " }}{{ else }}{{ $keywords }}{{ end }}" />
<meta name="author" content="{{ $author }}" />
<meta name="robots" content="index, follow" />

<!-- Open Graph / Facebook -->
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}" />
<meta property="og:url" content="{{ .Permalink }}" />
<meta property="og:title" content="{{ $title }}" />
<meta property="og:description" content="{{ $description }}" />
<meta property="og:site_name" content="{{ $site_name }}" />
{{ with $image }}
<meta property="og:image" content="{{ absURL . }}" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:type" content="image/png" />
{{ end }}
<meta property="og:locale" content="{{ site.Language.Lang | default "en" }}" />
{{ if .IsPage }}
<meta property="article:author" content="{{ $author }}" />
<meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}" />
{{ with .Lastmod }}
<meta property="article:modified_time" content="{{ .Format "2006-01-02T15:04:05Z07:00" }}" />
{{ end }}
{{ with .Params.categories }}
{{ range . }}
<meta property="article:section" content="{{ . }}" />
{{ end }}
{{ end }}
{{ with .Params.tags }}
{{ range . }}
<meta property="article:tag" content="{{ . }}" />
{{ end }}
{{ end }}
{{ end }}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content="{{ .Permalink }}" />
<meta name="twitter:title" content="{{ $title }}" />
<meta name="twitter:description" content="{{ $description }}" />
{{ with site.Params.metadata.twitter }}
<meta name="twitter:site" content="@{{ . }}" />
<meta name="twitter:creator" content="@{{ . }}" />
{{ end }}
{{ with $image }}
<meta name="twitter:image" content="{{ absURL . }}" />
<meta name="twitter:image:alt" content="{{ $title }}" />
{{ end }}

<!-- LinkedIn -->
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}" />

<!-- Additional SEO -->
<link rel="canonical" href="{{ .Permalink }}" />
{{ if .IsPage }}
{{ with .GetPage "section" }}
<meta property="article:section" content="{{ .Title }}" />
{{ end }}
{{ end }}

<!-- Language alternates -->
{{ if site.IsMultiLingual }}
{{ range site.Languages }}
{{ if ne . site.Language }}
<link rel="alternate" hreflang="{{ .Lang }}" href="{{ $.Permalink | absLangURL }}" />
{{ end }}
{{ end }}
<link rel="alternate" hreflang="x-default" href="{{ .Permalink | absURL }}" />
{{ end }}

<!-- Schema.org JSON-LD -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "{{ if .IsPage }}Article{{ else }}Organization{{ end }}",
  {{ if .IsPage }}
  "headline": "{{ $title }}",
  "description": "{{ $description }}",
  "author": {
    "@type": "Organization",
    "name": "{{ $author }}"
  },
  "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
  {{ with .Lastmod }}
  "dateModified": "{{ .Format "2006-01-02T15:04:05Z07:00" }}",
  {{ end }}
  "publisher": {
    "@type": "Organization",
    "name": "{{ $site_name }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ absURL site.Params.logo }}"
    }
  },
  {{ with $image }}
  "image": {
    "@type": "ImageObject",
    "url": "{{ absURL . }}",
    "width": 1200,
    "height": 630
  },
  {{ end }}
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ .Permalink }}"
  }
  {{ else }}
  "name": "{{ $site_name }}",
  "description": "{{ $description }}",
  "url": "{{ site.BaseURL }}",
  "logo": {
    "@type": "ImageObject",
    "url": "{{ absURL site.Params.logo }}"
  },
  "sameAs": [
    {{ with site.Params.metadata.twitter }}"https://twitter.com/{{ . }}"{{ end }}
    {{ with site.Params.metadata.facebook }}{{ if site.Params.metadata.twitter }},{{ end }}"https://facebook.com/{{ . }}"{{ end }}
  ]
  {{ end }}
}
</script>